# time_based_job_stats_extractor.py

## Overview

This module provides the `TimeBasedGlueJobStatsExtractor` class for extracting and reporting on Glue job statistics for
jobs that have run within a specified time period. It queries all Glue jobs, filters by execution time, and generates
summary reports.

---

## Classes

### TimeBasedGlueJobStatsExtractor

**Purpose:**  
Extracts execution statistics for Glue jobs that have run within a specified time period (e.g., last 24 hours).
Generates reports showing job performance metrics.

---

## Methods

### extract()

**Purpose:**  
Main extraction method. Queries all Glue jobs, filters by time period, and generates statistics report.

**Args:**

- None (retrieves parameters from Glue job arguments).

**Input Parameters (from Glue Arguments):**

- `time_period` (str, optional): Number of hours to look back. Default: `'24'`.
- `output_path` (str, required): S3 or local path where report will be saved.

**Returns:**

- None. Generates report as side effect.

**Raises:**

- Exception if Glue API call fails or output path invalid.

**Workflow:**

1. Configures logging.
2. Gets current UTC timestamp.
3. Retrieves all Glue job names.
4. Filters jobs by last successful run time (within time_period).
5. Generates statistics for matching jobs.
6. Saves report to output_path.

**Example:**

```python
extractor = TimeBasedGlueJobStatsExtractor()
extractor.extract()
# Extracts stats for jobs run in last 24 hours and saves to output_path
```

---

## Module Entry Point

```python
if __name__ == '__main__':
    extractor = TimeBasedGlueJobStatsExtractor()
    extractor.extract()
```

## Usage Examples

**Example 1: Extract stats for jobs run in last 24 hours**

```bash
# In Glue job script or step:
extractor = TimeBasedGlueJobStatsExtractor()
extractor.extract()
# Requires parameters: time_period=24, output_path=s3://bucket/reports/
```

**Example 2: Extract stats for last 7 days**

```bash
# Set time_period=168 (24 * 7 hours)
extractor.extract()
```

## Output Report

**Format:** Excel file (generated by underlying `GlueJobStatsExtractor.get_jobs_detail()`)

**File Name:** `data_{YYYY}_{MM}_{DD}_{HH}_{MM}_{SS}.xlsx`

**Columns:**

- Job Name
- Last Run ID
- Start Time
- End Time
- Execution Time (seconds)
- Allocated Capacity
- Max Capacity
- Worker Type
- Number Of Workers
- DPU Seconds

---

## Dependencies

- `GlueJobStatsExtractor`: For extracting detailed job statistics.
- `glue_utils`: For accessing Glue job arguments.
- boto3 Glue client

